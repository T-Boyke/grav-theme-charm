{% set feed_url = blog.url == '/' or blog.url == base_url_relative ? (base_url_relative~'/'~blog.slug) : blog.url %}
{% set new_base_url = blog.url == '/' ? '' : blog.url %}

{% if config.plugins.simplesearch.enabled %}
<div class="sidebar-content mb-8 p-6 bg-gray-50 rounded-lg shadow-sm">
    {% include 'partials/simplesearch_searchbox.html.twig' %}
</div>
{% endif %}
{% if config.plugins.relatedpages.enabled and related_pages|length > 0 %}
<div class="sidebar-content mb-8 p-6 bg-gray-50 rounded-lg shadow-sm">
    <h4 class="text-lg font-bold mb-4 border-b pb-2">{{ 'THEME_CHARM.SIDEBAR.RELATED_POSTS.HEADLINE'|t }}</h4>
    {% include 'partials/relatedpages.html.twig' %}
</div>
{% endif %}
{% if config.plugins.random.enabled %}
<div class="sidebar-content mb-8 p-6 bg-gray-50 rounded-lg shadow-sm">
	<h4 class="text-lg font-bold mb-4 border-b pb-2">{{ 'THEME_CHARM.SIDEBAR.RANDOM_ARTICLE.HEADLINE'|t }}</h4>
	<a class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors" href="{{ base_url }}/random"><i class="fa fa-retweet"></i> {{ 'THEME_CHARM.SIDEBAR.RANDOM_ARTICLE.FEELING_LUCKY'|t }}</a>
</div>
{% endif %}

{{ page.find('/modules/sidebar').content|raw }}

{% if config.plugins.taxonomylist.enabled %}
<div class="sidebar-content mb-8 p-6 bg-gray-50 rounded-lg shadow-sm">
    <h4 class="text-lg font-bold mb-4 border-b pb-2">{{ 'THEME_CHARM.SIDEBAR.POPULAR_TAGS.HEADLINE'|t }}</h4>
    {% include 'partials/taxonomylist.html.twig' with {'base_url':new_base_url, 'taxonomy':'tag', 'children_only':true} %}
</div>
{% endif %}
{% if config.plugins.archives.enabled %}
<div class="sidebar-content mb-8 p-6 bg-gray-50 rounded-lg shadow-sm">
    <h4 class="text-lg font-bold mb-4 border-b pb-2">{{ 'THEME_CHARM.SIDEBAR.ARCHIVES.HEADLINE'|t }}</h4>
	{% include 'partials/archives.html.twig' with {'base_url':new_base_url} %}
</div>
{% endif %}
{% if config.plugins.feed.enabled %}
<div class="sidebar-content syndicate mb-8 p-6 bg-gray-50 rounded-lg shadow-sm">
    <h4 class="text-lg font-bold mb-4 border-b pb-2">{{ 'THEME_CHARM.SIDEBAR.SYNDICATE.HEADLINE'|t }}</h4>
    <a class="inline-block px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 transition-colors mr-2 mb-2" href="{{ feed_url }}.atom"><i class="fa fa-rss-square"></i> Atom 1.0</a>
    <a class="inline-block px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 transition-colors mr-2 mb-2" href="{{ feed_url }}.rss"><i class="fa fa-rss-square"></i> RSS</a>
    {% if config.plugins.feed.enable_json_feed %}<a class="inline-block px-3 py-1 bg-orange-500 text-white rounded hover:bg-orange-600 transition-colors mb-2" href="{{ feed_url }}.json"><i class="fa fa-rss-square"></i> JSON</a>{% endif %}
</div>
{% endif %}
